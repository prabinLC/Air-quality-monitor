<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Air Quality Monitor Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        .sensor-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            transition: transform 0.3s ease;
        }
        
        .sensor-card:hover {
            transform: translateY(-5px);
        }
        
        .aqi-good { background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%); }
        .aqi-moderate { background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%); }
        .aqi-unhealthy { background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%); }
        .aqi-hazardous { background: linear-gradient(135deg, #833ab4 0%, #fd1d1d 100%); }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .status-online { background-color: #28a745; }
        .status-offline { background-color: #dc3545; }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px);
        }
        
        .sensor-value {
            font-size: 2rem;
            font-weight: bold;
        }
        
        .sensor-unit {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .last-update {
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        .chart-placeholder {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            color: #6c757d;
        }
        
        .data-table {
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="#"><strong>üå¨Ô∏è Air Quality Monitor</strong></a>
            <div class="navbar-nav ms-auto">
                <span class="nav-link">
                    <span id="connection-status" class="status-indicator status-online"></span>
                    <span id="connection-text">Online</span>
                    <small class="text-muted ms-2" id="refresh-info">Auto-refresh: 30s</small>
                </span>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- AQI Summary -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card sensor-card aqi-good" id="aqi-card">
                    <div class="card-body text-center">
                        <h2>Air Quality Index</h2>
                        <div class="sensor-value" id="aqi-value">--</div>
                        <div id="aqi-category">Loading...</div>
                        <small class="last-update" id="aqi-update">Fetching data...</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Current Readings -->
        <div class="row mb-4">
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card sensor-card">
                    <div class="card-body text-center">
                        <h6>PM2.5</h6>
                        <div class="sensor-value" id="pm25-value">--</div>
                        <small class="sensor-unit">Œºg/m¬≥</small>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card sensor-card">
                    <div class="card-body text-center">
                        <h6>CO‚ÇÇ</h6>
                        <div class="sensor-value" id="co2-value">--</div>
                        <small class="sensor-unit">ppm</small>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card sensor-card">
                    <div class="card-body text-center">
                        <h6>TVOC</h6>
                        <div class="sensor-value" id="tvoc-value">--</div>
                        <small class="sensor-unit">ppb</small>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card sensor-card">
                    <div class="card-body text-center">
                        <h6>Ozone</h6>
                        <div class="sensor-value" id="ozone-value">--</div>
                        <small class="sensor-unit">ppb</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Temperature & Humidity -->
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="card sensor-card">
                    <div class="card-body text-center">
                        <h6>Temperature</h6>
                        <div class="sensor-value" id="temp-value">--</div>
                        <small class="sensor-unit">¬∞C</small>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 mb-3">
                <div class="card sensor-card">
                    <div class="card-body text-center">
                        <h6>Humidity</h6>
                        <div class="sensor-value" id="humidity-value">--</div>
                        <small class="sensor-unit">%</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Simple Data View -->
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <h5>üìä Simple Data Visualization</h5>
                        <div class="chart-placeholder">
                            <h4>üìà</h4>
                            <p><strong>Real-time monitoring active!</strong></p>
                            <p>Data is being collected and displayed above.</p>
                            <small>For advanced charts, install: pip install plotly pandas</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <h6>üìã System Status</h6>
                        <p class="mb-2"><strong>Status:</strong> <span id="system-status" class="text-success">Active</span></p>
                        <p class="mb-2"><strong>Data Source:</strong> CSV File</p>
                        <p class="mb-2"><strong>Last Reading:</strong> <span id="last-reading-time">--</span></p>
                        <p class="mb-0"><strong>Total Readings:</strong> <span id="total-readings">--</span></p>
                        
                        <hr>
                        
                        <h6>üéØ Quick Tips</h6>
                        <ul class="small mb-0">
                            <li>Green = Good air quality</li>
                            <li>Yellow = Moderate quality</li>
                            <li>Red = Unhealthy levels</li>
                            <li>Data updates every 30 seconds</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Instructions -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="alert alert-info">
                    <h6>üöÄ Demo Instructions</h6>
                    <p class="mb-2">This dashboard displays data from the CSV file generated by the monitoring demo.</p>
                    <ol class="mb-0">
                        <li>Run <code>python AirIQ_demo.py</code> in another terminal to generate live data</li>
                        <li>This dashboard will automatically show the latest readings</li>
                        <li>Data refreshes every 30 seconds automatically</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        let refreshInterval;
        
        // Load current readings
        function loadCurrentReadings() {
            fetch('/api/current')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'ok') {
                        updateSensorReadings(data.readings);
                        updateAQI(data.aqi);
                        document.getElementById('connection-status').className = 'status-indicator status-online';
                        document.getElementById('connection-text').textContent = 'Online';
                        document.getElementById('system-status').textContent = 'Active';
                        document.getElementById('system-status').className = 'text-success';
                    }
                })
                .catch(error => {
                    console.error('Error loading current readings:', error);
                    document.getElementById('connection-status').className = 'status-indicator status-offline';
                    document.getElementById('connection-text').textContent = 'Offline';
                    document.getElementById('system-status').textContent = 'Error';
                    document.getElementById('system-status').className = 'text-danger';
                });
        }
        
        function updateSensorReadings(readings) {
            console.log('Received readings:', readings);
            
            // Update individual sensors with proper rounding
            document.getElementById('pm25-value').textContent = readings.pm2_5 ? readings.pm2_5.toFixed(1) : '--';
            document.getElementById('co2-value').textContent = readings.co2 ? Math.round(readings.co2) : '--';
            document.getElementById('tvoc-value').textContent = readings.tvoc ? Math.round(readings.tvoc) : '--';
            document.getElementById('ozone-value').textContent = readings.ozone ? readings.ozone.toFixed(1) : '--';
            document.getElementById('temp-value').textContent = readings.temperature ? readings.temperature.toFixed(1) : '--';
            document.getElementById('humidity-value').textContent = readings.humidity ? readings.humidity.toFixed(1) : '--';
            
            // Update timestamp
            if (readings.timestamp) {
                document.getElementById('last-reading-time').textContent = readings.timestamp;
                const updateElements = document.querySelectorAll('.last-update');
                updateElements.forEach(el => {
                    el.textContent = `Last updated: ${readings.timestamp}`;
                });
            }
        }
        
        function updateAQI(aqi) {
            document.getElementById('aqi-value').textContent = aqi.aqi;
            document.getElementById('aqi-category').textContent = aqi.category;
            
            const aqiCard = document.getElementById('aqi-card');
            aqiCard.className = 'card sensor-card';
            
            if (aqi.category.includes('Good')) {
                aqiCard.classList.add('aqi-good');
            } else if (aqi.category.includes('Moderate')) {
                aqiCard.classList.add('aqi-moderate');
            } else if (aqi.category.includes('Unhealthy')) {
                aqiCard.classList.add('aqi-unhealthy');
            } else if (aqi.category.includes('Hazardous')) {
                aqiCard.classList.add('aqi-hazardous');
            }
        }
        
        function loadStats() {
            fetch('/api/stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('total-readings').textContent = data.total_readings || '0';
                })
                .catch(error => console.error('Error loading stats:', error));
        }
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üå¨Ô∏è Ultra-Simple Air Quality Dashboard Initialized');
            
            // Load initial data
            loadCurrentReadings();
            loadStats();
            
            // Set up auto-refresh every 30 seconds
            refreshInterval = setInterval(() => {
                loadCurrentReadings();
                loadStats();
            }, 30000);
            
            console.log('‚úÖ Dashboard loaded successfully!');
            console.log('üîÑ Auto-refresh enabled (30 seconds)');
        });
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        });
    </script>
</body>
</html>